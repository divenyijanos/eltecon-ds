---
title: "Spam classification case study"
author: "Tamas Koncz"
date: "11/17/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.height = 4.5, fig.width = 9)
knitr::opts_chunk$set(fig.align='center')

library(knitr)
library(data.table)
library(ggplot2)
library(magrittr)
library(tidytext)
library(glue)
library(here)
```

## Exploratory analysis

We are going to work on the [sms-spam-or-ham](https://www.kaggle.com/dejavu23/sms-spam-or-ham-beginner/data) dataset from Kaggle:

_"The files contain one message per line. Each line is composed by two columns: v1 contains the label (ham or spam) and v2 contains the raw text."_

I recommend to take a look at the raw `.csv` first. Then, we can import it properly to R:

```{r}
sms <- fread(
    here::here("week10", "data", "spam.csv"),
    header = TRUE,
    select = c("v1", "v2"),
    col.names = c("is_spam", "sms_text"),
    encoding = 'Latin-1'
) %>%
    .[, is_spam := ifelse(is_spam == "spam", 1, 0)]
```

Let's see the frequency of spam messages in the dataset:

```{r}
sms %>%
    .[, .N, by = "is_spam"] %>%
    .[, share := scales::percent(N / sum(N), accuracy = 0.01)] %>%
    .[]
```

Our dataset is quite imbalanced. We'll have to pay attention to this when modeling.

### Message length

```{r}
sms[, sms_length := nchar(sms_text)]
```

```{r}
sms[, .(avg_sms_length = mean(sms_length)), by = "is_spam"]
```

Okay, this is interesting... let's dive deeper:

```{r, echo = FALSE}
spam_length     <- sms[is_spam == 1, .(median_sms_length = median(sms_length))]
non_spam_length <- sms[is_spam == 0, .(median_sms_length = median(sms_length))]

ggplot(
    sms,
    aes(x = sms_length, fill = as.factor(is_spam), color = as.factor(is_spam))
) +
    geom_density(alpha = 0.5) +
    labs(
        title = "Densities number of characters by sms type",
        subtitle = glue(
            "Median sms lengths: spam = {spam_length}",
            ", non-spam: {non_spam_length}"
        )
    ) +
    theme_minimal() +
    theme(legend.position = "top")
```

We might have just found our baseline model!
